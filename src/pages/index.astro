---
import BaseLayout from "@/astro/BaseLayout.astro";
import LinkButton from "@/astro/LinkButton.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("posts");
const sections = await getCollection("sections");
---

<BaseLayout title="Home">
  <div class="section">
    <div>
      <h2>Posts</h2>
      <div class="post-links">
        {
          posts.map((post) => {
            if (post.data.published) {
              return (
                <LinkButton
                  text={post.data.title}
                  href={`${post.collection}/${post.id}`}
                />
              );
            }
          })
        }
      </div>
    </div>
  </div>

  {
    sections.map((section) => {
      const enabled = section.data.items.filter((item) => item.enabled);

      console.log(enabled);

      if (enabled.length > 0) {
        return (
          <div class="section">
            <h2>{section.id}</h2>
            <div class="post-links">
              {section.data.items.map((item) => (
                <LinkButton text={item.title} href={item.href} external />
              ))}
            </div>
          </div>
        );
      }
    })
  }

  <div>
    <h2>Contact</h2>
    <p>contact@junaydb.com</p>
  </div>
</BaseLayout>

<style lang="scss">
  .section {
    margin-bottom: var(--separation-margin);
  }

  .post-links {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    padding: 4px;
    margin: -4px;
    background: rgba(98, 200, 170, 0.075);
    border-radius: 8px;
  }
</style>
